<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sjy.springboot.dao.UserDao" >

   <resultMap id="dynamic_userMap" type="com.sjy.springboot.model.UserDomin">
   <id property="userId" column="userId"/>
   <result property="userName" column="userName"/>
   <result property="password" column="password"/>
   <result property="phone" column="phone"/>
   </resultMap>

    <!--动态查询sql-->
   <select id="selectlike" parameterType="map" resultType="dynamic_userMap">
   select  * from t_user
   <where>

-- 根据前面
           <if test="pid!=null">
                   and id =#{pid}
           </if>
       <if test="pname!=njull">
               userName like #{pname}
       </if>
   </where>
   </select>
    <!--动态sql之更新-->
    <update id = "dynaUpdate" parameterType="Map">
            update t_user
    <set>
            <if test="pname!=null">
                    userName=#{pname},
            </if>
    <if test="ppassword!=null">
    password = #{ppassword},
    </if>
    </set>
    where id = #{pid}
    </update>
    <!-- 动态删除之数组版本 -->
        <delete id="dynaDeleteArray">
             delete from t_user where id in
                 <!-- 用于迭代数组元素的标签
                 collection表示类型
                  open表示开始的符号
                  close表示结束符号
                  separator表示元素之间的分隔符
                  item表示要迭代的数组 属性值可以随便写但是建议与形参名相同
                  #{ids} 表示数组中的元素
               -->
                 <foreach collection="array" open="(" close=")" separator="," item="ids" >
                     #{ids}
                 </foreach>
         </delete>

<!--动态sql之插入-->
    <sql id="key">
        <trim suffixOverrides=",">
            <if test = "id!=null">
                    id,
            </if>
      <if test="userName!=null">
              userName,
      </if>
    <if test="password">
            password,
    </if>
        </trim>
    </sql>
    <!--sql片段对应的值-->
    <sql id="value">
    <trim suffixOverrides=",">
        <if test = "id!=null">
            id,
        </if>
        <if test="userName!=null">
            userName,
        </if>
        <if test="password">
            password,
        </if>
    </trim>
    </sql>

    <sql id="BASE_TABLE">
    t_user
  </sql>



    <sql id="BASE_COLUMN">
    userId,userName,password,phone
  </sql>

    <insert id="dynaInsert" parameterType="com.sjy.springboot.model.UserDomin">
--     引用上面定义的sql片段
        insert into t_user(<include refid="key"></include>) values (<include refid="value"></include>)
    </insert>

    <!--原来的sql-->
    <insert id="insert" parameterType="com.sjy.springboot.model.UserDomin">
        INSERT INTO
        <include refid="BASE_TABLE"/>
        <trim prefix="(" suffix=")" suffixOverrides=",">
            userName,password,
            <if test="phone != null">
                phone,
            </if>
        </trim>
        <trim prefix="VALUES(" suffix=")" suffixOverrides=",">
            #{userName, jdbcType=VARCHAR},#{password, jdbcType=VARCHAR},
            <if test="phone != null">
                #{phone, jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>

    <select id="selectUsers" resultType="com.sjy.springboot.model.UserDomin">
        SELECT
        <include refid="BASE_COLUMN"/>
        FROM
        <include refid="BASE_TABLE"/>
    </select>


</mapper>
